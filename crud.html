<!-- This crud.html page will include all new script here rather than in script.js for grading purposes -->


<!DOCTYPE html>
<html lang="en">

<head>
    <title>Zoe Gaidmore Personal Website</title>
    <meta charset="UTF-8">
    <meta name="description" content="My personal website.">
    <meta name="keywords" content="Zoe, Portfolio, Computer Science, UCSD">
    <meta name="author" content="Zoe Gaidmore">
    <link rel="stylesheet" href="style.css">

    <script src="script.js"></script>

    <!-- This is where styling info will go -->
    <style>
        pretty-footer {
            display: block;
            text-align: right;
            font-family: Garamond, sans-serif;
            color: white;
            background: linear-gradient(to top, #f05f9c, #f8dbe8);
            padding: 2em; 
        }

        .crud-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .forms-container {
            display: flex;
            justify-content: space-between; 
            align-items: stretch;
            height: 100vh;
            width: 100%; 
        }
    </style>
    
</head>

<body>
    <header>
        <h1>CRUD actions</h1>
    </header>

    <label class="switch">
        <image src = "moon.png" id="themeToggle" onclick="toggleTheme()" width=50vh></image>
    </label>

    <a href="project-cards.html"><button>Return to Project Cards</button></a>

    <div class = "forms-container">

        <div class = "create"> 
            <h2>C</h2>
            <p>Create and add new card</p>

            <form id="create-form">
                <label for="title">Title:</label>
                <input type="text" id="c-title" required><br><br>

                <label for="image">Image URL:</label>
                <input type="text" id="c-image" required><br><br>

                <label for="alt">Image Alt Text:</label>
                <input type="text" id="c-alt" required><br><br>

                <label for="description">Description:</label>
                <input type="text" id="c-description" required><br><br>

                <label for="link">Link:</label>
                <input type="text" id="c-link" required><br><br>

                <button type="submit">Create Card</button>
                <button type="button" onclick="clearCreateForm()">Clear Form</button>
            </form>
        </div>

        <div class="update">
            <h2>U</h2>
            <p>Update an existing card</p>

            <form id="update-form">
                <label for="index">Index of card to Update/replace:</label>
                <input type="text" id="update-index" required><br><br>

                <label for="title">New title:</label>
                <input type="text" id="u-title" required><br><br>

                <label for="image">New image URL:</label>
                <input type="text" id="u-image" required><br><br>

                <label for="alt">Image Alt Text:</label>
                <input type="text" id="u-alt" required><br><br>

                <label for="description">New description:</label>
                <input type="text" id="u-description" required><br><br>

                <label for="link">New Link:</label>
                <input type="text" id="u-link" required><br><br>

                <button type="submit">Update Card</button>
                <button type="button" onclick="clearUpdateForm()">Clear Form</button>
            </form>

        </div>

        <div class="delete">
            <h2>D</h2>
            <p>Delete an existing card</p>

            <form id="delete-form">
                <label for="index">Index of card to Delete:</label>
                <input type="text" id="delete-index" required><br><br>

                <label for="confirmation">Are you sure you want to delete this card?</label> <br>

                <input type="radio" id="yes" name="confirmation" value="yes">
                <label for="yes">Yes</label><br>

                <input type="radio" id="no" name="confirmation" value="no">
                <label for="no">No</label><br><br>

                <button type="submit">Delete Card</button>
                <button type="button" onclick="clearDeleteForm()">Clear Form</button>
            </form>

        </div>
    </div>

    
    <h2>R</h2>
    <p>Read cards (display them!)</p>
    <p>Note: to update the cards after making a change, you'll have to hide and then show the cards again!</p>
    <button onclick="loadLocally()">Show Cards</button>

    <div class="crud-cards"></div>

    <div class="crud-hide-btn"></div>



    <script>
        async function loadLocally() {
            const container = document.querySelector(".crud-cards");

            // using localStorage API to get the json content
            let cards = JSON.parse(localStorage.getItem("cards")) || [];

            // if using netlify or something, you have to go directly to cards.json 
            if (!cards.length) {
                try {
                    const response = await fetch("/cards.json");
                    if (!response.ok) {
                        throw new Error("Failed to fetch cards.json");
                    }
                    cards = await response.json();
                    localStorage.setItem("cards", JSON.stringify(cards)); 
                } catch (error) {
                    console.error("Error loading cards:", error);
                }
            }

            cards.forEach((cardData) => {
                const card = document.createElement("project-card");
                card.setAttribute("title", cardData.title);
                card.setAttribute("image", cardData.image);
                card.setAttribute("alt", cardData.alt);
                card.setAttribute("description", cardData.description);
                card.setAttribute("link", cardData.link);
                container.appendChild(card);
            });

            const btn = document.querySelector(".crud-hide-btn");
            btn.innerHTML = `
                <button onclick="hideCrudCards()">Hide Cards</button>
            `;

            setSavedTheme();

        }

        function hideCrudCards() {
            const btn = document.querySelector(".crud-hide-btn");
            btn.innerHTML = '';
            const cards = document.querySelector(".crud-cards");
            cards.innerHTML = '';
        }

        // create form submission 
        document.getElementById("create-form").addEventListener("submit", async function (event) {
            event.preventDefault();

            // using localStorage API to get the json content
            let cards = JSON.parse(localStorage.getItem("cards")) || [];

            // if using netlify or something, you have to go directly to cards.json 
            if (!cards.length) {
                try {
                    const response = await fetch("/cards.json");
                    if (!response.ok) {
                        throw new Error("Failed to fetch cards.json");
                    }
                    cards = await response.json();
                    localStorage.setItem("cards", JSON.stringify(cards)); 
                } catch (error) {
                    console.error("Error loading cards:", error);
                }
            }


            const title = document.getElementById("c-title").value;
            const image = document.getElementById("c-image").value;
            const alt = document.getElementById("c-alt").value;
            const description = document.getElementById("c-description").value;
            const link = document.getElementById("c-link").value;

            const newCard = { title, image, alt, description, link };

            cards.push(newCard);
            localStorage.setItem("cards", JSON.stringify(cards));

            document.getElementById("create-form").reset();
            displayCards();
        });

        function clearCreateForm() {
            document.getElementById("create-form").reset();
        }

        function clearUpdateForm() {
            document.getElementById("update-form").reset();
        }

        function clearDeleteForm() {
            document.getElementById("delete-form").reset();
        }


        document.getElementById("update-form").addEventListener("submit", async function (event) {
            event.preventDefault();

            // using localStorage API to get the json content
            let cards = JSON.parse(localStorage.getItem("cards")) || [];

            // if using netlify or something, you have to go directly to cards.json 
            if (!cards.length) {
                try {
                    const response = await fetch("/cards.json");
                    if (!response.ok) {
                        throw new Error("Failed to fetch cards.json");
                    }
                    cards = await response.json();
                    localStorage.setItem("cards", JSON.stringify(cards)); 
                } catch (error) {
                    console.error("Error loading cards:", error);
                }
            }

            const index = parseInt(document.getElementById("update-index").value);  
            const title = document.getElementById("u-title").value; 
            const image = document.getElementById("u-image").value;
            const alt = document.getElementById("u-alt").value;
            const description = document.getElementById("u-description").value;
            const link = document.getElementById("u-link").value; 

        
            if (index >= 0 && index < cards.length) {

                const newCard = { title, image, alt, description, link };

                cards[index]=newCard;

                localStorage.setItem("cards", JSON.stringify(cards));
                clearUpdateForm();
            } 
            else {
                alert("Invalid index. Please enter a valid index.");
            }
        });


    document.getElementById("delete-form").addEventListener("submit", async function (event) {
            event.preventDefault();

            // using localStorage API to get the json content
            let cards = JSON.parse(localStorage.getItem("cards")) || [];

            // if using netlify or something, you have to go directly to cards.json 
            if (!cards.length) {
                try {
                    const response = await fetch("/cards.json");
                    if (!response.ok) {
                        throw new Error("Failed to fetch cards.json");
                    }
                    cards = await response.json();
                    localStorage.setItem("cards", JSON.stringify(cards)); 
                } catch (error) {
                    console.error("Error loading cards:", error);
                }
            }

            const index = parseInt(document.getElementById("delete-index").value);  
            const isYes = document.getElementById("yes").checked;
            const isNo = document.getElementById("no").checked;
        
            if (isYes) {
                if (index >= 0 && index < cards.length) {
                    cards.splice(index, 1);
                    localStorage.setItem("cards", JSON.stringify(cards));
                    clearDeleteForm();
                }
            } 
            else {
                alert("Invalid index. Please enter a valid index.");
            }
    });


    </script>
</body>

</html>